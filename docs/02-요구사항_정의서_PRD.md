# 요구사항 정의서 (PRD: Product Requirements Document)

**프로젝트:** VHDL 파싱 및 시각적 디버깅  
**범위:** 이 모듈이 "무엇을 달성해야 하는가"에 대한 기준 정의.  
**보완:** AST 기반 4단계 심층 파싱 및 Tree-sitter 엔진 도입 방향 반영.

---

## 요구사항 목록

| ID | 구분 | 요구사항 명 | 상세 설명 | 중요도 |
| --- | --- | --- | --- | --- |
| **REQ-01** | 기능 | **VHDL 파일 읽기** | 로컬 환경의 `.vhd` 파일을 읽어올 수 있어야 한다. | 필수 |
| **REQ-02** | 기능 | **AST 기반 심층 파싱 엔진 도입** | 정규표현식이 아닌 Tree-sitter(또는 동급 엔진)를 활용하여 VHDL 코드를 추상 구문 트리(AST)로 변환한다. | 필수 |
| **REQ-03** | 기능 | **1/2단계: 인터페이스 및 선언부 파싱** | `entity`, `port` (방향, 타입, 비트폭 포함), `generic` 및 내부 `signal`, 사용자 정의 타입(`type`), 상수(`constant`)를 개별 노드로 분리하여 추출한다. | 필수 |
| **REQ-04** | 기능 | **3단계: 구조적/병행 구문 파싱** | `component` 인스턴스화(`port map`), `generate` 반복문, 병행 신호 할당 구문 등을 파싱하여 모듈 간 결합 관계를 추출한다. | 높음 |
| **REQ-05** | 기능 | **4단계: 동작적/순차 구문 파싱** | `process` 블록, 감지 목록(Sensitivity list), 상태머신(FSM) 전이 조건을 포함한 제어문(`if`, `case`)을 파싱하여 논리적 흐름을 구조화한다. | 중간 |
| **REQ-06** | 기능 | **JSON 데이터 출력** | 파싱된 모든 데이터를 계층적 구조의 JSON 파일로 저장 및 출력한다. (전체 AST 덤프 포함 옵션) | 필수 |
| **REQ-07** | 기능 | **시각적 디버깅 출력** | 디버깅을 위해 파싱된 연결 상태를 Graphviz 기반 이미지(`.png` 또는 `.svg`)로 렌더링한다. | 필수 |
| **REQ-08** | 비기능 | **모듈화 및 확장성** | 파서 로직과 데이터 모델을 분리하여, 향후 **웹 기반 렌더링 테스트 및 VS Code 확장 프로그램(Extension)에 원활하게 연동**될 수 있어야 한다. | 높음 |
| **REQ-09** | 비기능 | **점진적 파싱 및 초경량화 대비** | 변경된 코드 부분만 추적할 수 있는 구조를 채택하여, 향후 VS Code 확장에서 WASM 형태로 구동될 때 성능 저하(무거움)가 없도록 대비한다. | 높음 |

---

## 요구사항별 검증 관점

- **REQ-01:** 지정 경로의 `.vhd` 파일이 존재할 때 내용을 문자열로 읽을 수 있는지.
- **REQ-02 & REQ-09:** 파서 엔진이 VHDL 파일의 모든 문법 요소를 `Unknown`이나 누락 없이 **전체 AST JSON으로 덤프(Dump)**해 낼 수 있는지. 점진적 파싱(Incremental Parsing) 지원 여부.
- **REQ-03:** 1/2단계 — `entity`/`port`/`generic`/`signal`/`type`/`constant`가 개별 노드로 추출되는지. Port의 데이터 타입·버스 폭·초기값까지 세분화되는지.
- **REQ-04:** 3단계 — 단일 문법만 포함된 마이크로 테스트 파일(예: `test_port_map.vhd`, `test_generate.vhd`)을 통과하여 `component`/`port map`/`generate`가 정확한 JSON 계층으로 분리되는지.
- **REQ-05:** 4단계 — `test_process.vhd`, `test_fsm.vhd` 등으로 `process`/감지 목록/제어문이 구조화되는지.
- **REQ-06:** 동일 입력에 대해 일관된 계층 구조의 JSON이 생성되는지. AST 전체 덤프 옵션 동작 여부.
- **REQ-07:** 동일 데이터로 DOT/이미지가 생성되고, in/out 등 방향이 시각적으로 구분되는지.
- **REQ-08:** `core` / `models` / `exporters` 분리가 유지되고, 외부에서 데이터 모델만 주입해 출력할 수 있는지.

---

## 파서 엔진 선택에 따른 비기능 고려 (REQ-09)

- **Tree-sitter:** C 기반, 에디터용 실시간 파싱에 최적화. **WASM**으로 컴파일 시 수백 KB 수준으로 경량·고속. **점진적 파싱**으로 수정 구간만 갱신 가능.
- **Python 바인딩:** 현재 파이썬 파이프라인과 호환 유지. 추후 VS Code 확장(TypeScript/WASM) 전환 시 렌더링 로직 구조 재사용 가능.
